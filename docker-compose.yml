
services:
  # API Service (Spring Boot)
  api-service:
    build:
      context: ./thoughts-to-post-api-service
      dockerfile: Dockerfile
    container_name: thoughts-api-service
    ports:
      - "8080:8080"
    environment:
      # Use GATEWAY_IP to connect to MongoDB on the Windows host
      - SPRING_DATA_MONGODB_URI=mongodb://admin:admin123@${GATEWAY_IP}:27017/thoughtstopost?authSource=admin
      # Use WSL_IP for Kafka (native service in WSL)
      - SPRING_KAFKA_BOOTSTRAP_SERVERS=${WSL_IP}:9092
      - LINKEDIN_CLIENT_ID=${LINKEDIN_CLIENT_ID:-your-client-id}
      - LINKEDIN_CLIENT_SECRET=${LINKEDIN_CLIENT_SECRET:-your-client-secret}
      - LINKEDIN_REDIRECT_URI=http://localhost:8080/api/oauth/linkedin/callback
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - thoughts-network

  # AI Agent (Python)
  ai-agent:
    build:
      context: ./thoughts-to-post-ai-agent
      dockerfile: Dockerfile
    container_name: thoughts-ai-agent
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=${WSL_IP}:9092
      - KAFKA_TOPIC_REQUESTS=thoughts-requests
      - KAFKA_TOPIC_RESPONSES=thoughts-responses
      - OLLAMA_HOST=http://${WSL_IP}:11434
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - thoughts-network

  # Angular UI
  angular-ui:
    build:
      context: ./thoughts-to-post-angular-ui
      dockerfile: Dockerfile
    container_name: thoughts-angular-ui
    ports:
      - "4200:80"
    depends_on:
      - api-service
    networks:
      - thoughts-network

networks:
  thoughts-network:
    driver: bridge
